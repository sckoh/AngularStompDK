/*! AngularStompDK v0.3.0 */
!function(){"use strict";var t=function(){function t(t,s){for(var i in s){var n=s[i];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(t,s)}return function(s,i,n){return i&&t(s.prototype,i),n&&t(s,n),s}}(),s=function(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")},i=function(){function i(){s(this,i),this.settings={}}return t(i,{credential:{value:function(t,s){return this.settings.login=t,this.settings.password=s,this}},url:{value:function(t){var s=function(s){return t.apply(this,arguments)};return s.toString=function(){return t.toString()},s}(function(t){return this.settings.url=t,this})},"class":{value:function(t){return this.settings["class"]=t,this}},setting:{value:function(t){return this.settings=t,this}},debug:{value:function(t){return this.settings.debug=t,this}},vhost:{value:function(t){return this.settings.vhost=t,this}},$get:{value:["$q","$log","$rootScope","Stomp","$timeout","Session",function(t,s,i,e,o,r){return new n(this.settings,t,s,i,e,o,r)}]}}),i}(),n=function(){function i(t,n,e,o,r,u,c){s(this,i),this.settings=t,this.settings.RECONNECT_TIMEOUT=this.settings.RECONNECT_TIMEOUT?this.settings.RECONNECT_TIMEOUT:3e3,this.$q=n,this.$timeout=u,this.Stomp=r,this.$log=e,this.$rootScope=o,this.connections=[],this.deferred=this.$q.defer(),this.promiseResult=this.deferred.promise,this.subscribed=[],this.Session=c,this.connect()}return t(i,{prepareUrlWithToken:{value:function(){return this.settings.url+"?access_token="+this.Session.getSocialBearerToken(!0)}},connect:{value:function(){var t=this;return this.stompClient=this.settings["class"]?this.Stomp.over(new this.settings["class"](this.prepareUrlWithToken())):this.Stomp.client(this.prepareUrlWithToken()),this.stompClient.debug=this.settings.debug?this.$log.debug:function(){},this.stompClient.connect({},function(){t.deferred.resolve();for(var s=0,i=t.subscribed.length;i>s;s++)t.subscribed[s].subscribeFn();t.$digestStompAction()},function(){console.log("fail ws"),t.$timeout(function(){t.connect()},t.settings.RECONNECT_TIMEOUT),t.$digestStompAction()}),this.promiseResult}},subscribe:{value:function(t,s,i,n){var e=this;return this.promiseResult.then(function(){var o=function(){e.$stompSubscribe(t,s,i||{}),e.unRegisterScopeOnDestroy(n,t)};e.subscribed.push({url:t,subscribeFn:o}),o()}),this}},unsubscribe:{value:function(t){var s=this;return this.promiseResult.then(function(){return s.$stompUnSubscribe(t)}),this}},send:{value:function(t,s,i){var n=this,e=this.$q.defer();return this.promiseResult.then(function(){n.stompClient.send(t,i||{},JSON.stringify(s)),e.resolve()}),e.promise}},disconnect:{value:function(){var t=this,s=this.$q.defer();return this.stompClient.disconnect(function(){s.resolve(),t.$digestStompAction()}),s.promise}},$stompSubscribe:{value:function(t,s,i){var n=this,e=n.stompClient.subscribe(t,function(){s.apply(n.stompClient,arguments),n.$digestStompAction()},i);this.connections.push({url:t,subscription:e})}},$stompUnSubscribe:{value:function(t){for(var s=!1,i=0,n=this.connections.length;n>i;i++)if(this.connections[i].url===t){s=i,this.connections[i].subscription.unsubscribe();break}s!==!1&&this.connections.splice(s,1);for(var e=!1,o=0,n=this.subscribed.length;n>o;o++)if(this.subscribed[o].url===t){e=o;break}e!==!1&&this.subscribed.splice(e,1)}},$digestStompAction:{value:function(){!this.$rootScope.$$phase&&this.$rootScope.$apply()}},unRegisterScopeOnDestroy:{value:function(t,s){var i=this;void 0!==t&&angular.isFunction(t.$on)&&t.$on("$destroy",function(){return i.unsubscribe(s)})}}}),i}();angular.module("AngularStompDK",[]).provider("ngstomp",i).constant("Stomp",window.Stomp)}();
//# sourceMappingURL=angular-stomp.min.js.map